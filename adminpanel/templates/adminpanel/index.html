<!doctype html>
<html>
<head>
  <title>Dashboard</title>
  <style>
    .kpi { display:inline-block; border:1px solid #ddd; padding:12px; margin:6px; min-width:180px; }
    .kpi h3 { margin:0 0 6px 0; font-size:14px; color:#666; }
    .kpi .v { font-size:20px; font-weight:600; }
    .low { color:#b00020; }
    .grid { display:flex; flex-wrap:wrap; gap:12px; }
    table { border-collapse: collapse; }
    th, td { border:1px solid #ddd; padding:6px 8px; }
  </style>
</head>
<body>
<h1>Business Dashboard</h1>

<form method="get">
  <label>Category:
    <select name="category">
      <option value="">All</option>
      {% for c in categories %}
        <option value="{{ c.category_id }}" {% if category_id == c.category_id|stringformat:"s" %}selected{% endif %}>{{ c.category_name }}</option>
      {% endfor %}
    </select>
  </label>
  <label>Start: <input type="date" name="start" value="{{ start_date }}"></label>
  <label>End: <input type="date" name="end" value="{{ end_date }}"></label>
  <button type="submit">Apply</button>
  <a href="{% url 'adminpanel:inventory_list' %}">Inventory</a> |
  <a href="{% url 'adminpanel:catalogue_list' %}">Catalogue</a> |
  <a href="{% url 'adminpanel:customer_list' %}">Customers</a>
</form>

<div class="grid">
  <div class="kpi">
    <h3>Total SKUs</h3>
    <div class="v">{{ total_skus }}</div>
  </div>
  <div class="kpi">
    <h3>Low Stock Items</h3>
    <div class="v low">{{ low_stock_count }}</div>
  </div>
  <div class="kpi">
    <h3>Total Units On Hand</h3>
    <div class="v">{{ total_units }}</div>
  </div>
  <div class="kpi">
    <h3>Inventory Value</h3>
    <div class="v">${{ inventory_value|floatformat:2 }}</div>
  </div>
  <div class="kpi">
    <h3>Revenue ({{ start_date }} â†’ {{ end_date }})</h3>
    <div class="v">${{ sales_revenue|floatformat:2 }}</div>
  </div>
  <div class="kpi">
    <h3>Units Sold</h3>
    <div class="v">{{ units_sold }}</div>
  </div>
  <div class="kpi">
    <h3>Orders</h3>
    <div class="v">{{ orders_count }}</div>
  </div>
</div>

<h2>Top Products (Units Sold)</h2>
<table>
  <tr><th>SKU</th><th>Name</th><th>Units</th></tr>
  {% for tp in top_products %}
    <tr>
      <td>{{ tp.product__sku }}</td>
      <td>{{ tp.product__product_name }}</td>
      <td>{{ tp.total_qty }}</td>
    </tr>
  {% empty %}
    <tr><td colspan="3">No sales in selected range.</td></tr>
  {% endfor %}
</table>
</body>
</html>